<!DOCTYPE html>

<html lang='en-US'>

<head>

    <meta charset='utf-8'>

    <title>SWOLE</title>
    
    <meta name='description' content=''>

    <meta name='author' content='SWOLE'>

    <meta name='viewport' content='width=device-width, initial-scale=1.0'>

    <!--Favicon-->
    <link rel='icon' href='./img/favicon.png' type='image/png'>

    <!--CSS-->
    <link rel='stylesheet' href='init.css'>
    <link rel='stylesheet' href='index.css'>

</head>

<body>


    <main>
        <h1 class='jumbo'>SWOLE</h1>
        <ul class='content-list workout-list'>
        
        </ul>

        <a href='workout.html'>
            <svg class='u-button-bottom-right' width="80px" height="80px" viewBox="0 0 80 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <title>plus icon</title>
            <defs></defs>
            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                <g id="stuff-on-screen-(masked)" sketch:type="MSLayerGroup" transform="translate(-284.000000, -605.000000)">
                    <g id="home-page" transform="translate(16.000000, 15.000000)" sketch:type="MSShapeGroup">
                        <g id="plus-icon" transform="translate(268.000000, 590.000000)">
                            <circle id="Oval-3" fill="#419BF9" cx="40" cy="40" r="40"></circle>
                            <path d="M46.4,34 L46.4,16 L34.4,16 L34.4,34 L16.4,34 L16.4,46 L34.4,46 L34.4,64 L46.4,64 L46.4,46 L64.4,46 L64.4,34 L46.4,34 Z" id="Rectangle-9" fill="#FFFFFF"></path>
                        </g>
                    </g>
                </g>
            </g></svg>
        </a>
    </main>


    <script type="text/javascript">
        function asyncGet(url, json, cb, errcb) {
            // var to contain async data
            var asyncData;

            // xhr object accessible in entire function
            var xhr;

            // number of request attempts; call errcb after 20 unsuccessful attempts
            var attempts = 0;

            // make async request
            makeRequest(url);

            function makeRequest(url) {
                xhr = new XMLHttpRequest();
                // run prepdata when response received from server
                xhr.onreadystatechange = prepData;
                // send request
                xhr.open('GET', url, true);
                xhr.send();
            }

            function prepData() {
                // readyState 4 means xhr request successful and response received from server
                // http status 200 means server OK'd response (200: "OK")
                // note that status should be 0 when retrieving from filesystem (without HTTP server)
                if (xhr.readyState === 4 && xhr.status === 200) {
                    if (json === true) { // if json
                        asyncData = JSON.parse(xhr.responseText);
                    } else if (json === false) { // if text
                        asyncData = xhr.responseText;
                    } else console.log('asyncGet(json) argument was not a bool');
                    // call a function that uses the data
                    cb(asyncData);
                } else {
                    attempts++;
                    console.log('asyncGet(' + url + '): No response received yet (attempt ' + attempts + '), retrying...');
                    // after 4 failed requests
                    if (attempts >= 4) {
                        console.log('asyncGet(' + url + '): failed to load resource after ' + attempts + ' attempts. Will now call errcb if given.');
                        // call error cb with url
                        if (errcb && typeof(errcb) === "function") errcb(url);
                    } else return; // return, browser will try again
                }
            }
        }

        function requestFailure(url, attempts) {
            alert('Failed to load ' + url + ' after ' + attempts + ' attempts.');
        }

        asyncGet('data.json',true,useData,requestFailure);


        function useData(data) {
            displayWorkouts(data.workouts);
        }

        function displayWorkouts(workouts) {
            // select element with 'workout-list' class. Returns htmlcollection array and we select [0] because there should only be one
            var workoutList = document.getElementsByClassName('workout-list')[0];
            for(var workoutName in workouts) {
                // create an anchor tag for each workout
                var workout = document.createElement('a');

                // add each anchor tag to key section
                workoutList.appendChild(workout);

                // add workout name
                workout.outerHTML = '<a href="workout.html#' + workoutName + '"><li>'+ workoutName +'</li></a>';
            } 
        }

    </script>

</body>

</html>
